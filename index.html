<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cato Dogs Journal</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body{padding:1rem}
  .dog-photo{height:120px;width:120px;object-fit:cover;border-radius:12px;border:1px solid #e5e7eb}
  .tab-pane{padding-top:1rem}
  .error{background:#fee2e2;border:1px solid #ef4444;color:#991b1b;padding:.75rem;border-radius:.5rem;margin:.5rem 0}
</style>
</head>
<body>
  <h1 class="text-center mb-3">Cato Dogs Journal</h1>

  <div class="d-flex gap-3 align-items-center justify-content-center mb-3 flex-wrap">
    <div class="text-center">
      <img src="photos/thor.jpg" class="dog-photo" alt="Thor" onerror="this.src='photos/placeholder.png'">
      <div class="small">Thor</div>
    </div>
    <div class="text-center">
      <img src="photos/mia.jpg" class="dog-photo" alt="Mia" onerror="this.src='photos/placeholder.png'">
      <div class="small">Mia</div>
    </div>
  </div>

  <ul class="nav nav-tabs" role="tablist">
    <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#ov" type="button">Overview</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#wl" type="button">Weights & Lengths</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#care" type="button">Care Plan</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#birth" type="button">Birth Log</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#bios" type="button">Bios</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#vet" type="button">Vet & Worming</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#photosTab" type="button">Photos</button></li>
  </ul>

  <div class="tab-content">

    <div class="tab-pane fade show active" id="ov"><div id="ovWrap" class="mt-2">Loading overview…</div></div>

    <div class="tab-pane fade" id="wl">
      <h5>Weights</h5>
      <div class="table-responsive">
        <table class="table table-sm table-bordered" id="tblW"><thead><tr><th>Day</th><th>Pup 2 (Blue)</th><th>Pup 3 (Pink)</th><th>Pup 5 (Orange)</th></tr></thead><tbody></tbody></table>
      </div>
      <h5 class="mt-3">Lengths</h5>
      <div class="table-responsive">
        <table class="table table-sm table-bordered" id="tblL"><thead><tr><th>Day</th><th>Pup 2</th><th>Pup 3</th><th>Pup 5</th></tr></thead><tbody></tbody></table>
      </div>
    </div>

    <div class="tab-pane fade" id="care"><div id="careWrap">Loading…</div></div>

    <div class="tab-pane fade" id="birth">
      <div class="table-responsive">
        <table class="table table-sm table-bordered" id="tblBirth">
          <thead><tr><th>#</th><th>Time</th><th>Sex</th><th>Status</th><th>Placenta</th><th>Notes</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="tab-pane fade" id="bios"><div id="biosWrap">Loading…</div></div>

    <div class="tab-pane fade" id="vet">
      <div class="table-responsive">
        <table class="table table-sm table-bordered" id="tblVet">
          <thead><tr><th>Date</th><th>Who</th><th>Type</th><th>Cost</th><th>Notes</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="tab-pane fade" id="photosTab">
      <div class="row g-2" id="photosWrap"></div>
      <div class="text-muted small">Add image files to <code>/photos</code> and list them via <code>window.photosList</code>.</div>
    </div>

  </div>

  <div id="err" class="error d-none"></div>

<script>
  function bust(u){ const x=new URL(u, location.href); x.searchParams.set('v', Date.now()); return x; }
  async function jget(u){
    try{
      const r = await fetch(bust(u), {cache:'no-store'});
      if(!r.ok) throw new Error('HTTP '+r.status);
      return await r.json();
    }catch(e){
      const el=document.getElementById('err'); el.classList.remove('d-none'); el.textContent='Failed to load '+u+' → '+e.message; 
      return null;
    }
  }
  function cell(v){ return (v===undefined||v===null)? '' : v; }

  async function loadOverview(){
    const ov = await jget('data/overview.json');
    const w = document.getElementById('ovWrap');
    if(!ov){ w.textContent=''; return; }
    if(ov.summary){
      w.innerHTML = '<p>'+ov.summary+'</p>'+ (ov.notes? '<div class="text-muted">'+ov.notes+'</div>':'');
      return;
    }
    const s = ov.litter_summary || {};
    w.innerHTML = '<table class="table table-sm table-bordered"><tr><th>Total Pups</th><th>Live</th><th>Stillborn</th><th>Whelping Window</th></tr>' +
                  `<tr><td>${cell(s.total_pups)}</td><td>${cell(s.live)}</td><td>${cell(s.stillborn)}</td><td>${cell(s.whelping_window)}</td></tr></table>` +
                  (ov.notes? `<div class="text-muted">${ov.notes}</div>`:'');
  }

  async function loadWL(){
    const w = await jget('data/weights.json');
    const l = await jget('data/lengths.json');
    const tbW = document.querySelector('#tblW tbody'); tbW.innerHTML='';
    const tbL = document.querySelector('#tblL tbody'); tbL.innerHTML='';
    (w?.weights || w?.records || []).forEach(r=>{
      tbW.innerHTML += `<tr><td>${cell(r.day)}</td><td>${cell(r.pup2)}</td><td>${cell(r.pup3)}</td><td>${cell(r.pup5)}</td></tr>`;
    });
    (l?.records || []).forEach(r=>{
      tbL.innerHTML += `<tr><td>${cell(r.day)}</td><td>${cell(r.pup2)}</td><td>${cell(r.pup3)}</td><td>${cell(r.pup5)}</td></tr>`;
    });
  }

  async function loadCare(){
    const c = await jget('data/care.json');
    const w = document.getElementById('careWrap'); w.innerHTML='';
    (c || []).forEach(item=>{
      const row = document.createElement('div');
      row.className='border rounded p-2 mb-2';
      row.innerHTML = `<b>Week ${cell(item.week)}</b> — ${cell(item.text)} ${item.done? '<span class="badge text-bg-success ms-2">Done</span>':''}`;
      w.appendChild(row);
    });
    if(!(c||[]).length) w.textContent='No care entries yet.';
  }

  async function loadBirth(){
    const bl = await jget('data/birth_log.json');
    const tb = document.querySelector('#tblBirth tbody'); tb.innerHTML='';
    (bl || []).forEach((r,i)=>{
      tb.innerHTML += `<tr><td>${cell(r.p) || (i+1)}</td><td>${cell(r.time)}</td><td>${cell(r.sex)}</td><td>${cell(r.status)}</td><td>${cell(r.placenta)}</td><td>${cell(r.notes)}</td></tr>`;
    });
  }

  async function loadBios(){
    let bios = await jget('data/dogs.json');
    if(bios && !Array.isArray(bios)){ // also support {mia:{}, thor:{}}
      bios = Object.keys(bios).map(k=> { const o=bios[k]; o.id=k; o.name=k.charAt(0).toUpperCase()+k.slice(1); return o; });
    }
    const host = document.getElementById('biosWrap'); host.innerHTML='';
    (bios || []).forEach(b=>{
      const card = document.createElement('div');
      card.className='border rounded p-2 mb-2';
      card.innerHTML = `<div><b>${cell(b.name)}</b> • ${cell(b.breed||'')}</div>
        <div class="small text-muted">Sex: ${cell(b.sex)} | DOB: ${cell(b.dob)} | Weight: ${cell(b.weight||b.weight_kg||'')} | Microchip: ${cell(b.microchip||'')}</div>
        ${b.last_vet? `<div class="small">Last vet: ${b.last_vet}</div>`:''}
        ${b.notes? `<div class="small">${b.notes}</div>`:''}`;
      host.appendChild(card);
    });
    if(!(bios||[]).length) host.textContent='No bios yet.';
  }

  async function loadVet(){
    const ev = await jget('data/vet.json');
    const tb = document.querySelector('#tblVet tbody'); tb.innerHTML='';
    (ev || []).forEach(row=>{
      tb.innerHTML += `<tr><td>${cell(row.date)}</td><td>${cell(row.who)}</td><td>${cell(row.type)}</td><td>${cell(row.cost)}</td><td>${cell(row.notes)}</td></tr>`;
    });
  }

  function loadPhotos(){
    const names = (window.photosList||[]);
    const w = document.getElementById('photosWrap'); w.innerHTML='';
    names.forEach(n=>{
      const col = document.createElement('div'); col.className='col-6 col-md-3';
      col.innerHTML = `<img src="photos/${n}" class="img-fluid rounded border" onerror="this.src='photos/placeholder.png'">`;
      w.appendChild(col);
    });
    if(!names.length){
      w.innerHTML = '<div class="text-muted">Add image files to <code>/photos</code> and list them in <code>window.photosList</code>.</div>';
    }
  }

  window.photosList = ["thor.jpg", "mia.jpg"]; // edit to your actual filenames

  loadOverview(); loadWL(); loadCare(); loadBirth(); loadBios(); loadVet(); loadPhotos();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
