<!doctype html>
<html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mia & Thor — Puppy Journal</title>
<style>
:root{--border:#e2e8f0} *{box-sizing:border-box}
body{font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif;margin:0;background:#f7fafc;color:#0f172a}
header{padding:12px 16px;background:#fff;border-bottom:1px solid var(--border)}
.container{max-width:1100px;margin:0 auto;padding:16px}
.card{background:#fff;border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:0 2px 6px rgba(15,23,42,.06)}
.banner{display:flex;align-items:center;gap:10px;border:1px dashed var(--border);padding:8px;border-radius:10px;margin-bottom:12px;background:#fff}
.banner img{width:72px;height:72px;border-radius:10px;border:1px solid var(--border);object-fit:cover}
#chart{width:100%;height:520px} .legend{display:flex;gap:12px;margin:8px 0 12px 0;flex-wrap:wrap}
.legend label{display:flex;gap:6px;align-items:center;border:1px solid var(--border);border-radius:8px;background:#fff;padding:6px 10px}
table{width:100%;border-collapse:collapse;margin-top:8px} th,td{border:1px solid var(--border);padding:8px;text-align:center}
</style></head>
<body>
<header><h1>Mia & Thor — Puppy Journal</h1></header>
<main class="container">
  <div class="card banner">
    <img id="thorImg" alt="Thor">
    <img id="miaImg" alt="Mia">
    <div style="color:#334155">Thor (Cane Corso) • Mia (Rottweiler)</div>
    <label style="margin-left:auto;border:1px solid var(--border);padding:6px 10px;border-radius:8px;cursor:pointer;">Set photos<input id="setPhotos" type="file" accept="image/*" multiple hidden></label>
    <button id="clearPhotos" style="border:1px solid var(--border);background:#fff;border-radius:8px;padding:6px 10px;cursor:pointer;margin-left:6px">Clear</button>
  </div>
  <div class="card">
    <h2>Weights & Interactive Chart</h2>
    <div class="legend" id="legend"></div>
    <svg id="chart" viewBox="0 0 960 520" preserveAspectRatio="xMidYMid meet"></svg>
    <details open><summary>Raw Data</summary>
      <table id="tbl"><thead><tr><th>Day</th><th>Pup 2</th><th>Pup 3</th><th>Pup 5</th></tr></thead><tbody></tbody></table>
    </details>
  </div>
</main>
<script>
{common_js}

// Load weights.json from /data
async function load() {{
  const res = await fetch('data/weights.json', {{cache:'no-store'}});
  const j = await res.json();
  const days = j.weights.map(r=>r.day), p2 = j.weights.map(r=>r.pup2), p3 = j.weights.map(r=>r.pup3), p5 = j.weights.map(r=>r.pup5);
  const svg=document.getElementById('chart'), W=960,H=520,M={{l:64,r:24,t:24,b:46}}, innerW=W-M.l-M.r, innerH=H-M.t-M.b;
  const all=[...p2,...p3,...p5]; const yMin=Math.floor((Math.min(...all)-40)/20)*20, yMax=Math.ceil((Math.max(...all)+60)/20)*20;
  const x=d=>M.l+((d-days[0])/(15-days[0]))*innerW, y=v=>M.t+innerH-((v-yMin)/(yMax-yMin))*innerH;
  function L(x1,y1,x2,y2,c){{const e=document.createElementNS('http://www.w3.org/2000/svg','line');e.setAttribute('x1',x1);e.setAttribute('y1',y1);e.setAttribute('x2',x2);e.setAttribute('y2',y2);e.setAttribute('stroke',c||'#e2e8f0');return e;}}
  function T(x0,y0,t){{const e=document.createElementNS('http://www.w3.org/2000/svg','text');e.setAttribute('x',x0);e.setAttribute('y',y0);e.setAttribute('font-size','12');e.setAttribute('fill','#334155');e.setAttribute('text-anchor','middle');e.textContent=t;return e;}}
  function P(d,c,w=2.5){{const e=document.createElementNS('http://www.w3.org/2000/svg','path');e.setAttribute('d',d);e.setAttribute('fill','none');e.setAttribute('stroke',c);e.setAttribute('stroke-width',w);return e;}}
  function C(cx,cy,c){{const e=document.createElementNS('http://www.w3.org/2000/svg','circle');e.setAttribute('cx',cx);e.setAttribute('cy',cy);e.setAttribute('r',4);e.setAttribute('fill',c);return e;}}
  for(let gy=yMin; gy<=yMax; gy+=50){{const yy=y(gy); svg.appendChild(L(M.l,yy,W-M.r,yy));}}
  svg.appendChild(L(M.l,M.t,M.l,H-M.b,'#94a3b8')); svg.appendChild(L(M.l,H-M.b,W-M.r,H-M.b,'#94a3b8'));
  for(let d=days[0]; d<=15; d++){{svg.appendChild(T(x(d),H-M.b+18,'Day '+d));}}
  for(let gy=yMin; gy<=yMax; gy+=100){{const yy=y(gy); const t=T(M.l-10,yy+4,gy); t.setAttribute('text-anchor','end'); svg.appendChild(t);}}
  svg.appendChild(T(M.l-42,M.t-6,'Weight (g)'));
  const colors=['#1f77b4','#e45756','#4c9a2a'];
  const legend=document.getElementById('legend'); const series=[{{k:'Pup 2',v:p2,c:colors[0]}},{{k:'Pup 3',v:p3,c:colors[1]}},{{k:'Pup 5',v:p5,c:colors[2]}}];
  const layer=document.createElementNS('http://www.w3.org/2000/svg','g'); svg.appendChild(layer);
  series.forEach(s=>{{const lab=document.createElement('label'); const cb=document.createElement('input'); cb.type='checkbox'; cb.checked=true; const sw=document.createElement('span'); sw.style.cssText='display:inline-block;width:12px;height:12px;border-radius:6px;background:'+s.c; const tx=document.createElement('span'); tx.textContent=' '+s.k; lab.appendChild(cb); lab.appendChild(sw); lab.appendChild(tx); legend.appendChild(lab); s.cb=cb;}});
  function draw(){{ while(layer.firstChild) layer.removeChild(layer.firstChild);
    series.forEach(s=>{{ if(!s.cb.checked) return; let d=''; s.v.forEach((v,i)=>{{ d+=(i?'L':'M')+x(days[i])+' '+y(v)+' '; }}); layer.appendChild(P(d,s.c)); s.v.forEach((v,i)=> layer.appendChild(C(x(days[i]),y(v),s.c))); }});
  }}
  legend.addEventListener('change', draw); draw();
  // table
  const tb=document.querySelector('#tbl tbody'); j.weights.forEach(r=>{{const tr=document.createElement('tr'); tr.innerHTML=`<td>${{r.day}}</td><td>${{r.pup2}}</td><td>${{r.pup3}}</td><td>${{r.pup5}}</td>`; tb.appendChild(tr);}});
}}
load();
</script>
</body></html>
